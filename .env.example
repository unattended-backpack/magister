# Example runtime environment configuration for Magister.
# Copy this file to .env and adjust as needed.
#
# Configuration priority (highest to lowest):
# 1. Environment variables (from this .env file when using Docker)
# 2. TOML file (magister.toml)
# 3. Default values
#
# Note: When using 'make run', this .env file will override values in magister.toml

# ============================================================================
# REQUIRED CONFIGURATION
# ============================================================================

# Publicly accessible address where this Magister can be reached.
# Used by Hierophant to send drop requests via HTTP.
# Format: http://[host]:[port] (do not include trailing slash or /drop path)
# THIS_MAGISTER_ADDR=http://magister

# IP address or hostname where Contemplants can reach Hierophant.
# Passed to Contemplants when they are created so they know where to connect.
# HIEROPHANT_IP=hierophant

# HTTP port where Hierophant is listening.
# Contemplants will connect via WebSocket at ws://[HIEROPHANT_IP]:[HIEROPHANT_HTTP_PORT]/ws
# HIEROPHANT_HTTP_PORT=9010

# Vast.ai API key for managing instances.
# Obtain from https://vast.ai/ under Account > API Keys
# VAST_API_KEY=your-vast-api-key-here

# Vast.ai template hash to use for creating instances.
# Template should contain a Contemplant image configured to run on startup.
# Find template hash in the Vast.ai web console under your saved templates.
# TEMPLATE_HASH=819fdf2e42fc8ceb32f295465b5bb21e

# Number of instances to maintain.
# Magister will continuously monitor and ensure this many instances are running.
# NUMBER_INSTANCES=1

# ============================================================================
# OPTIONAL CONFIGURATION
# ============================================================================

# HTTP server port (default: 8555).
# HTTP_PORT=8555

# Seconds to wait between Vast.ai API calls (default: 10).
# Helps avoid rate limiting from Vast.ai.
# VAST_API_CALL_BACKOFF_SECS=10

# Seconds between instance polling checks (default: 30).
# How often Magister checks if instances need to be created or cleaned up.
# TASK_POLLING_INTERVAL_SECS=30

# Seconds to wait for Contemplant verification (default: 180).
# How long to wait after creating an instance for the Contemplant to call /verify
# before considering the instance failed and dropping it.
# CONTEMPLANT_VERIFICATION_TIMEOUT_SECS=180

# ============================================================================
# VAST QUERY CONFIGURATION
# ============================================================================

# Allocated storage in GB for the instance.
#VAST_QUERY_ALLOCATED_STORAGE=16

# GPU model name to search for.
# Common options: "RTX 4090", "RTX 3090", "A100", etc.
# VAST_QUERY_GPU_NAME=RTX 4090

# Minimum host reliability score (0.0 to 1.0).
# Higher values mean more reliable hosts but fewer options.
# VAST_QUERY_RELIABILITY=0.99

# Minimum CUDA version required.
# VAST_QUERY_MIN_CUDA_VERSION=12.8

# Minimum GPU RAM in GB.
# VAST_QUERY_GPU_RAM=24

# Minimum disk space in GB.
# VAST_QUERY_DISK_SPACE=100

# Minimum rental duration in hours.
# Higher values may give better availability.
# VAST_QUERY_DURATION=192679

# Maximum cost per hour in USD.
# Instances costing more than this will be filtered out.
# VAST_QUERY_COST_PER_HOUR=0.60

# ============================================================================
# MACHINE FILTERING (OPTIONAL)
# ============================================================================

# Comma-separated list of Vast.ai host IDs to avoid.
# Instances will not be created on these hosts.
# BAD_HOSTS=213498,74292,113132

# Comma-separated list of Vast.ai machine IDs to avoid.
# Instances will not be created on these machines.
# BAD_MACHINES=12217,19571

# Comma-separated list of preferred Vast.ai host IDs.
# These hosts will be prioritized when creating instances.
# GOOD_HOSTS=207289,1276

# Comma-separated list of preferred Vast.ai machine IDs.
# These machines will be prioritized when creating instances.
# GOOD_MACHINES=13428,8218

# ============================================================================
# CONTEMPLANT CONFIGURATION (OPTIONAL)
# ============================================================================
# These settings control the configuration of Contemplants spawned by this Magister.
# They are passed as environment variables to Contemplants created on Vast.ai.
# Note: MAGISTER_DROP_ENDPOINT and HIEROPHANT_WS_ADDRESS are managed automatically.

# Prover type: "cpu" or "cuda" (default: "cpu").
# CPU proving is slower but doesn't require GPU-specific setup.
# CONTEMPLANT_PROVER_TYPE=cpu

# Human-readable name for Contemplants (default: generated from names.txt).
# CONTEMPLANT_NAME=paulos

# Port for HTTP health check server (default: 9011).
# CONTEMPLANT_HTTP_PORT=9011

# Moongate CUDA prover endpoint (default: none).
# Only used when prover_type is "cuda". If not set, Contemplant will spin up
# a moongate-server Docker container automatically.
# CONTEMPLANT_MOONGATE_ENDPOINT=http://localhost:3000/twirp/

# Heartbeat interval in seconds (default: 30).
# How often Contemplants tell Hierophant they are still alive.
# CONTEMPLANT_HEARTBEAT_INTERVAL_SECONDS=30

# Maximum number of finished proofs stored in memory (default: 2).
# CONTEMPLANT_MAX_PROOFS_STORED=2

# Path to log file for progress tracking (default: "./moongate.log").
# CONTEMPLANT_MOONGATE_LOG_PATH=./moongate.log

# Log polling interval in milliseconds (default: 2000).
# How frequently to check the moongate log file for progress updates.
# CONTEMPLANT_WATCHER_POLLING_INTERVAL_MS=2000

